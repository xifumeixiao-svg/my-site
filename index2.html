<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€æ‰‹å‹•èªè¨¼ã€‘ã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹ã¸ã®æ„›ãƒ†ã‚¹ãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS: ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fce7f3; /* è–„ã„ãƒ”ãƒ³ã‚¯ã®èƒŒæ™¯ */
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(214, 122, 153, 0.2);
            max-width: 600px;
            width: 100%;
            text-align: left;
        }
        
        @media (max-width: 640px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 1.8em;
            }
        }

        h1 {
            color: #d67a99; /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ */
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0e0e4;
            padding-bottom: 10px;
            font-size: 2em;
            font-weight: 700;
        }

        .question-item {
            margin-bottom: 25px;
            padding: 15px;
            border-left: 5px solid #d67a99;
            background-color: #fffafc;
            border-radius: 8px;
        }

        .question-item label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: #555;
        }

        .question-item input[type="text"], .access-gate input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ffccd9;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .question-item input[type="text"]:focus, .access-gate input[type="password"]:focus {
            outline: none;
            border-color: #d67a99;
            box-shadow: 0 0 5px rgba(214, 122, 153, 0.5);
        }

        button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #d67a99;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s ease, transform 0.1s;
        }

        button:hover {
            background-color: #c06987;
            transform: translateY(-1px);
        }

        .result-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .result-screen h2 {
            font-size: 2.2em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .pass h2 {
            color: #4CAF50; /* åˆæ ¼ã¯ç·‘ */
        }

        .fail h2, .access-denied h2 {
            color: #F44336; /* ä¸åˆæ ¼ãƒ»åˆ¶é™ã¯èµ¤ */
        }

        .pass p {
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .secret-password {
            display: inline-block;
            background-color: #d67a99;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .next-step-button {
            background-color: #4CAF50;
            margin-top: 20px;
            width: auto;
            padding: 12px 30px;
        }

        .next-step-button:hover {
            background-color: #45a049;
        }

        .access-denied {
            text-align: center;
            padding: 50px;
            color: #F44336;
        }

        .access-denied p {
            font-size: 1.1em;
        }

        .access-gate {
            text-align: center;
            padding: 50px 20px;
        }

        .error-message {
            color: #F44336;
            margin-top: 15px;
            font-size: 0.9em;
            height: 20px; /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚·ãƒ•ãƒˆé˜²æ­¢ */
        }

        /* ã‚¢ã‚¯ã‚»ã‚¹ã‚²ãƒ¼ãƒˆç”¨ã®ãƒœã‚¿ãƒ³ */
        .access-gate button {
            width: auto;
            padding: 12px 40px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>

    <div class="container" id="app">
        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯JavaScriptã§æŒ¿å…¥ã•ã‚Œã¾ã™ -->
    </div>

    <script>
        // JavaScript: ãƒ†ã‚¹ãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯

        // --- ğŸ”‘ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç·¨é›†å¯èƒ½ã‚¨ãƒªã‚¢ ğŸ”‘ ---

        // ğŸš¨ æ‰‹å‹•å…¥åŠ›ã®ãŸã‚ã®ç§˜å¯†ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ (ã“ã‚Œã‚’æ•™ãˆãŸäººã ã‘ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™)
        const ACCESS_KEY = 'house'; 
        const ACCESS_GRANTED_KEY = 'shareHouseAccessGranted'; // ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ä¿å­˜ã™ã‚‹ã‚­ãƒ¼
        
        const testData = [
            { id: 1, question: "ã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹ã®è¨­ç«‹å¹´ã¯ï¼Ÿï¼ˆåŠè§’æ•°å­—ã§ã€€ä¾‹ï¼šï¼’ï¼ï¼’ï¼å¹´â†’2020ï¼‰", answerKeywords: ["2011", "2014"] },
            { id: 2, question: "ã‚ªãƒ¼ãƒŠãƒ¼ã•ã‚“ã®è»Šã®ãƒŠãƒ³ãƒãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ï¼Ÿï¼ˆåŠè§’æ•°å­—ã§ã€€ä¾‹ï¼šï¼ï¼‘ï¼’ï¼™â†’0129ï¼‰", answerKeywords: ["0214"] },
            { id: 3, question: "ã‚ªãƒ¼ãƒŠãƒ¼ã•ã‚“ãŒå¥½ãã§ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã—ã¦ã„ã‚‹ã€100å·»ã‚’è¶…ãˆã‚‹æŠ•ç¨¿è€…ã‹ã‚‰ã®å‹•ç”»ã‚’é›†ã‚ãŸã‚·ãƒªãƒ¼ã‚ºã‚‚ã®ãƒ›ãƒ©ãƒ¼æ˜ ç”»ã®ã‚¿ã‚¤ãƒˆãƒ«ã¯ï¼Ÿï¼ˆæ¼¢å­—äº”æ–‡å­—ï¼‰", answerKeywords: ["å¿ƒéœŠé—‡å‹•ç”»"] },
            { id: 4, question: "ã‚ªãƒ¼ãƒŠãƒ¼ã•ã‚“ã®ç¾åœ¨ã®å®¶æ—æ§‹æˆã¯ï¼Ÿä¸€äººæŒ™ã’ã‚ˆï¼ˆæ¼¢å­—ï¼‰", answerKeywords: ["å¦¹"] },
            { id: 5, question: "ã€Œäººå–°ã„ã®å³¶ã€ã€Œå¹»ã®9éšã€ã€Œéˆ´è˜­ã¯çœ ã‚‰ãªã„ã€ç­‰ã®ä½œå“ã‚’æ‰‹æ›ã‘ã‚‹ã€å¤§é˜ªåºœå®ˆå£å¸‚ç”Ÿã¾ã‚Œã®ãƒ›ãƒ©ãƒ¼ä½œå®¶ã®åå‰ã¯ï¼Ÿï¼ˆæ¼¢å­—ã¾ãŸã¯ã²ã‚‰ãŒãªã§ï¼‰", answerKeywords: ["æ¸¡åƒæ", "ã‚ãŸã‚Šã¡ãˆ"] },
            { id: 6, question: "ã‚ªãƒ¼ãƒŠãƒ¼ã•ã‚“ã®å¥½ããªè‰²ã¯ï¼Ÿï¼ˆã²ã‚‰ãŒãªï¼‰", answerKeywords: ["ã´ã‚“ã", "ãƒ”ãƒ³ã‚¯"] },
            { 
                id: 7, 
                question: "ã“ã®ã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹ã®ä½æ‰€ã¯ï¼Ÿã€ŒéŒå€‰å¸‚ã€ã‹ã‚‰ç•ªåœ°ã¯ã€Œã€‡-ã€‡-ã€‡ã€ã§æ›¸ã‘ï¼ˆåŠè§’æ•°å­—ï¼‰ã€‚", 
                answerKeywords: ["éŒå€‰å¸‚è¥¿éŒå€‰1175"] 
            },
        ]; 

        // 7å•ä¸­ã€3å•ä»¥ä¸‹æ­£è§£ã§åˆæ ¼ (åˆæ ¼åŸºæº–: æ„›ãŒå¼·ã™ããªã„ï¼æ­£è§£ã—ã™ããªã„)
        const PASS_SCORE_MAX = 3; 
        
        const TEST_COMPLETED_KEY = 'shareHouseLoveTestCompleted'; // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
        const SECRET_PASS = 'wasitu'; // åˆæ ¼æ™‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        const NEXT_SITE_URL = 'https://benrijun08.wixsite.com/my-site-1/post/è¥¿éŒå€‰ã®ã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹ã«æ³¨æ„'; // é·ç§»å…ˆURL
        // ----------------------------------------

        const app = document.getElementById('app');

        // --- ğŸ”’ ã‚«ãƒ³ãƒ‹ãƒ³ã‚°é˜²æ­¢ç”¨é–¢æ•° ---

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²æ­¢ã™ã‚‹æ±ç”¨é–¢æ•°
        function preventDefault(event) {
            event.preventDefault();
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’é˜²æ­¢ã™ã‚‹é–¢æ•°
        function preventKeyboardShortcuts(event) {
            // F5ã¾ãŸã¯Ctrl+R (ãƒªãƒ­ãƒ¼ãƒ‰)
            if ((event.key === 'F5') || (event.ctrlKey && (event.key === 'r' || event.key === 'R'))) {
                preventDefault(event);
            }
            // Alt + å·¦/å³çŸ¢å° (æˆ»ã‚‹/é€²ã‚€)
            if (event.altKey && (event.key === 'ArrowLeft' || event.key === 'ArrowRight')) {
                preventDefault(event);
            }
            // F12 (é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«)
            if (event.key === 'F12') {
                preventDefault(event);
            }
        }

        // ã‚«ãƒ³ãƒ‹ãƒ³ã‚°é˜²æ­¢æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ (ãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ã™ã‚‹)
        function activateCheatingPrevention() {
            // å³ã‚¯ãƒªãƒƒã‚¯(ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼)ã‚’ç¦æ­¢
            document.addEventListener('contextmenu', preventDefault);
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚’ç¦æ­¢
            document.addEventListener('keydown', preventKeyboardShortcuts);
        }

        // ã‚«ãƒ³ãƒ‹ãƒ³ã‚°é˜²æ­¢æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ (ãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã™ã‚‹)
        function deactivateCheatingPrevention() {
            document.removeEventListener('contextmenu', preventDefault);
            document.removeEventListener('keydown', preventKeyboardShortcuts);
        }

        // é›¢è„±é˜²æ­¢ã®ãŸã‚ã®ãƒªã‚¹ãƒŠãƒ¼é–¢æ•° (è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
        function handleBeforeUnload(event) {
            // ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¦ã„ãªã„å ´åˆã«ã®ã¿å®Ÿè¡Œ
            if (localStorage.getItem(TEST_COMPLETED_KEY) === null) {
                // ãƒ–ãƒ©ã‚¦ã‚¶ã«è¡¨ç¤ºã•ã‚Œã‚‹è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®š
                event.returnValue = 'ãƒ†ã‚¹ãƒˆã®é€”ä¸­ã§ãƒšãƒ¼ã‚¸ã‚’ç§»å‹•ã™ã‚‹ã¨ã€çµæœãŒä¿å­˜ã•ã‚Œãšã€å†å—é¨“ã‚‚ã§ããªããªã‚Šã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ';
                return 'ãƒ†ã‚¹ãƒˆã®é€”ä¸­ã§ãƒšãƒ¼ã‚¸ã‚’ç§»å‹•ã™ã‚‹ã¨ã€çµæœãŒä¿å­˜ã•ã‚Œãšã€å†å—é¨“ã‚‚ã§ããªããªã‚Šã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ';
            }
        }
        // --- ğŸ”’ ã‚«ãƒ³ãƒ‹ãƒ³ã‚°é˜²æ­¢ç”¨é–¢æ•° ã“ã“ã¾ã§ ---

        /**
         * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°: å…¨è§’ã‚’åŠè§’ã«ã€ã²ã‚‰ãŒãªã‚’ã‚«ã‚¿ã‚«ãƒŠã«çµ±ä¸€ã—ã€è¨˜å·ã‚’å‰Šé™¤ã™ã‚‹ï¼ˆãƒ­ãƒã‚¹ãƒˆãªåˆ¤å®šã®ãŸã‚ï¼‰
         * @param {string} text - å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ
         * @returns {string} - æ­£è¦åŒ–ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
         */
        function normalizeText(text) {
            if (!text) return '';
            // 1. å…¨è§’è‹±æ•°å­—ã‚’åŠè§’ã«
            let normalized = text.replace(/[ï¼-ï¼™ï¼¡-ï¼ºï½-ï½š]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
            // 2. ã²ã‚‰ãŒãªã‚’ã‚«ã‚¿ã‚«ãƒŠã«
            normalized = normalized.replace(/[\u3041-\u3096]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) + 0x60);
            });
            // 3. å…¨ã¦ã®ç©ºç™½ãƒ»å¥èª­ç‚¹ãƒ»ä½æ‰€ã«ä½¿ã‚ã‚Œã‚‹è¨˜å·ï¼ˆãƒã‚¤ãƒ•ãƒ³ã€é•·éŸ³ç¬¦ãªã©ï¼‰ã‚’å‰Šé™¤ã—ã€å°æ–‡å­—ã«å¤‰æ›
            // å‰Šé™¤è¨˜å·: ã‚¹ãƒšãƒ¼ã‚¹(åŠè§’/å…¨è§’), å¥èª­ç‚¹(ã€ã€‚ï¼ï¼Ÿãƒ»), ä½æ‰€è¨˜å·(-, ï¼, ãƒ¼, /, ., :)
            return normalized.replace(/[\sã€€ã€ã€‚ï¼ï¼Ÿãƒ»\-\uFF0D\u30FC\/\.\:]/g, '').toLowerCase();
        }
        
        // --- ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®é–‹å§‹é–¢æ•° ---
        function mainFlow() {
            // ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ã‚‹ã‹ç¢ºèªã™ã‚‹
            const hasAccess = localStorage.getItem(ACCESS_GRANTED_KEY) === 'true';

            // 1. èªè¨¼å¾Œã®é€šå¸¸ãƒ•ãƒ­ãƒ¼
            if (hasAccess) {
                const testStatus = localStorage.getItem(TEST_COMPLETED_KEY);
                if (testStatus === 'fail') {
                    displayAccessDenied();
                } else if (testStatus === 'pass') {
                    // åˆæ ¼æ¸ˆã¿ã®å ´åˆã¯é›¢è„±é˜²æ­¢ã‚’ç„¡åŠ¹ã«ã—ã¦çµæœç”»é¢ã¸
                    deactivateCheatingPrevention();
                    displayResult(true);
                } else {
                    // æœªå—é¨“ã®å ´åˆã¯ãƒ†ã‚¹ãƒˆç”»é¢ã‚’è¡¨ç¤ºã—ã€ã‚«ãƒ³ãƒ‹ãƒ³ã‚°é˜²æ­¢ã‚’æœ‰åŠ¹åŒ–
                    displayTestForm();
                }
            } else {
                // ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒãªã„å ´åˆã¯ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚²ãƒ¼ãƒˆã‚’è¡¨ç¤º
                displayAccessGate();
            }
        }
        // --- ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®é–‹å§‹é–¢æ•° ã“ã“ã¾ã§ ---


        /**
         * ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼å…¥åŠ›ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆé™å®šå…¬é–‹ã‚²ãƒ¼ãƒˆï¼‰
         */
        function displayAccessGate() {
            let html = `
                <div class="access-gate">
                    <h1 class="text-3xl">ğŸ”‘ é™å®šå…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼å…¥åŠ›</h1>
                    <p class="mb-8 text-gray-600">
                        ã“ã®ãƒ†ã‚¹ãƒˆã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’çŸ¥ã£ã¦ã„ã‚‹æ–¹é™å®šã§ã™ã€‚<br>
                        ç™ºè¡Œã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                    </p>
                    <form id="accessForm">
                        <input 
                            type="password" 
                            id="accessKeyInput" 
                            placeholder="ç§˜å¯†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" 
                            required
                            class="mb-4"
                        >
                        <div id="accessError" class="error-message"></div>
                        <button type="submit" class="access-gate-button">ãƒ†ã‚¹ãƒˆã«é€²ã‚€</button>
                    </form>
                </div>
            `;
            app.innerHTML = html;

            document.getElementById('accessForm').addEventListener('submit', handleAccessSubmit);
        }
        
        /**
         * ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼é€ä¿¡æ™‚ã®å‡¦ç†
         * @param {Event} event - ãƒ•ã‚©ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
         */
        function handleAccessSubmit(event) {
            event.preventDefault();
            const inputKey = document.getElementById('accessKeyInput').value.trim();
            const errorElement = document.getElementById('accessError');

            // ğŸš¨ ã“ã“ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ 'house' ã¨æ¯”è¼ƒ
            if (inputKey === ACCESS_KEY) {
                // æ­£ã—ã„ã‚­ãƒ¼ã®å ´åˆ
                localStorage.setItem(ACCESS_GRANTED_KEY, 'true');
                errorElement.textContent = '';
                // ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¸é·ç§»
                displayTestForm(); 
            } else {
                // é–“é•ã£ã¦ã„ã‚‹å ´åˆ
                errorElement.textContent = 'ã‚¨ãƒ©ãƒ¼: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
            }
        }


        /**
         * ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹
         */
        function displayTestForm() {
            let html = '<h1>ã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹ã¸ã®æ„›ãƒ†ã‚¹ãƒˆâ™¡ï¼ˆå…¨7å•ï¼‰</h1>'; 
            html += '<p class="text-center mb-6 text-sm text-gray-600">';
            html += 'ã“ã®ãƒ†ã‚¹ãƒˆã¯ã€ã‚ãªãŸãŒã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹ã«ã¤ã„ã¦ã©ã®ç¨‹åº¦çŸ¥è­˜ãŒã‚ã‚‹ã®ã‹ã€ã‚¯ã‚¤ã‚ºå½¢å¼ã§å‡ºé¡Œã—ã¾ã™ã€‚å…¨7å•ï¼<br>';
            html += 'â€»æ­£ç¢ºãªæ¸¬å®šã®ç‚ºã€ã‚ã‹ã‚‰ãªã„å ´åˆã¯ç´ ç›´ã«ã€Œã‚ã‹ã‚‰ãªã„ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>';
            html += 'å°šã€ã‚«ãƒ³ãƒ‹ãƒ³ã‚°é˜²æ­¢ã®ç‚ºãƒ†ã‚¹ãƒˆä¸­ã«ã“ã®ã‚µã‚¤ãƒˆã‚’é›¢ã‚Œã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚';
            html += '</p>';
            html += '<form id="testForm">';

            testData.forEach(item => {
                html += `
                    <div class="question-item">
                        <label for="q${item.id}">${item.id}. ${item.question}</label>
                        <input type="text" id="q${item.id}" name="q${item.id}" required>
                    </div>
                `;
            });

            html += '<button type="submit">æ„›ã‚’åˆ¤å®šã™ã‚‹</button>';
            html += '</form>';

            app.innerHTML = html;

            document.getElementById('testForm').addEventListener('submit', handleFormSubmit);
            
            // ğŸš¨ ãƒ†ã‚¹ãƒˆä¸­ã¯é›¢è„±é˜²æ­¢ã¨ã‚«ãƒ³ãƒ‹ãƒ³ã‚°é˜²æ­¢ã‚’æœ‰åŠ¹åŒ–
            window.addEventListener('beforeunload', handleBeforeUnload);
            activateCheatingPrevention(); 
        }

        /**
         * ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
         * @param {Event} event - ãƒ•ã‚©ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
         */
        function handleFormSubmit(event) {
            event.preventDefault();
            
            // ğŸš¨ ãƒ†ã‚¹ãƒˆå®Œäº†ã®ãŸã‚ã€ã™ã¹ã¦ã®é˜²æ­¢æ©Ÿèƒ½ã‚’è§£é™¤
            window.removeEventListener('beforeunload', handleBeforeUnload);
            deactivateCheatingPrevention();

            const formData = new FormData(event.target);
            let score = 0;

            testData.forEach(item => {
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã‚’æ­£è¦åŒ–
                const userAnswer = normalizeText(formData.get(`q${item.id}`) || '');

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ãŒã€å®šç¾©ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ã„ãšã‚Œã‹ã¨ä¸€è‡´ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const isCorrect = item.answerKeywords.some(keyword => {
                    // æ­£è§£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚‚æ­£è¦åŒ–
                    const normalizedKeyword = normalizeText(keyword);
                    
                    // åˆ¤å®šï¼šéƒ¨åˆ†ä¸€è‡´ (å›ç­”ãŒæ­£è§£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€)
                    return userAnswer.includes(normalizedKeyword);
                });

                if (isCorrect) {
                    score++;
                }
            });

            // 7å•ä¸­ã€3å•ä»¥ä¸‹æ­£è§£ãŒåˆæ ¼ (æ„›ãŒå¼·ã™ãã‚‹ã¨ä¸åˆæ ¼)
            const passed = score <= PASS_SCORE_MAX; 
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«çµæœã‚’ä¿å­˜
            localStorage.setItem(TEST_COMPLETED_KEY, passed ? 'pass' : 'fail');

            // çµæœç”»é¢ã‚’è¡¨ç¤º
            displayResult(passed);
        }

        /**
         * çµæœç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹
         * @param {boolean} passed - åˆå¦
         */
        function displayResult(passed) {
            let html = '';

            // åˆå¦ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€é˜²æ­¢æ©Ÿèƒ½ã¯å®Œå…¨ã«ç„¡åŠ¹åŒ–
            deactivateCheatingPrevention();

            if (passed) {
                html = `
                    <div class="result-screen pass">
                        <h2>åˆæ ¼ï¼æ­£è§£ã§ããªãã¦å½“ç„¶â™¡</h2>
                        <p>
                            ã“ã“ã¾ã§ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼<br>
                           <br>
                            ã‚µã‚¤ãƒˆã®é–²è¦§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯<span class="secret-password">ã€${SECRET_PASS}ã€</span>ã§ã™ã€‚
                        </p>
                        <button class="next-step-button" onclick="window.location.href='${NEXT_SITE_URL}'">
                            ç§˜å¯†ã®ã‚µã‚¤ãƒˆã¸è¡Œã
                        </button>
                    </div>
                `;
            } else {
                html = `
                    <div class="result-screen fail">
                        <h2>æ„›ãŒå¼·ã™ãã¾ã™ï¼</h2>
                        <p>ã‚ãªãŸã¯ã‹ãªã‚Šæ„›å¼·ã‚ã§ã™ã­ï¼<br>
                        æ–‡å¥ãªã—ï¼ã‚‚ã†ä½•ã‚‚è¨€ã†ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚â€»å†å—é¨“ã¯ã§ãã¾ã›ã‚“</p>
                    </div>
                `;
            }

            app.innerHTML = html;
        }

        /**
         * ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹
         */
        function displayAccessDenied() {
            // ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ç”»é¢ã§ã¯ã€é˜²æ­¢æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–
            deactivateCheatingPrevention();
            window.removeEventListener('beforeunload', handleBeforeUnload);

            const html = `
                <div class="access-denied">
                    <h2>ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ¶é™ã•ã‚Œã¦ã„ã¾ã™</h2>
                    <p>æ„›ã®ãƒ†ã‚¹ãƒˆå—é¨“æ¸ˆã¿ã®ç‚ºã€å†åº¦ã‚µã‚¤ãƒˆã‚’é–‹ãã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚</p>
                </div>
            `;
            app.innerHTML = html;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã‚’é–‹å§‹
        mainFlow();

    </script>
</body>
</html>